---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import Footer from "../../components/Footer.astro";

const { type } = Astro.params;

export async function getStaticPaths() {
  const posts = await getCollection("texts");
  const types = [...new Set(posts.map((post: any) => post.data.type))]; // Obtener tipos únicos
  return types.map((type) => ({
    params: { type },
  }));
}

let typeTitle: any = "";
if (type === "lagrimas") {
  typeTitle = "Lágrimas de Siddartha";
} else if (type === "colores") {
  typeTitle = "En las luces de colores";
} else if (type === "still") {
  typeTitle = "Still Prefer Sentir";
} else if (type === "placebo") {
  typeTitle = "Placebo Onírico";
} else if (type === "pintas") {
    typeTitle = "Pintas Heredadas";
} else {
  typeTitle = type;
}

let typeDescription: any = "";
if (type === "lagrimas") {
  typeDescription = '"Cuando miro a las nubes, no hay nadie más. Soy solo yo."';
} else if (type === "colores") {
    typeDescription = '"A través de mis sueños y añoranzas empezó la búsqueda del sentido."';
} else if (type === "still") {
    typeDescription = '"El calor de tu piel me dio razones para despertar."';
} else if (type === "placebo") {
    typeDescription = '"Escribir con un vacío en el pecho. Hallar en la insignificancia un camino hacia la libertad."';
} else if (type === "pintas") {
    typeDescription = '"Va de hallar dentro lo que siempre se ha buscado fuera."';
}

const posts = (await getCollection("texts"))
  .sort((a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .filter((post: any) => post.data.type === type);
---

<Layout title={typeTitle}>
  <main class="flex flex-col gap-4 mt-32 px-6 w-full sm:max-w-[1100px] sm:mx-auto">
    <h1 class="text-4xl font-bold text-left font-bebas">
      {typeTitle}
    </h1>
    <p class="text-left text-3xl font-normal font-tangerine">
        {typeDescription}
    </p>
    <ul class="flex flex-col sm:grid sm:grid-cols-5 w-full gap-4 text-center justify-center">
      {
        posts.map((post: any) => (

          <li class="w-full text-center">
            <a href={`/${type}/${post.slug}/`} class="">
              <div class="relative overflow-hidden rounded-lg aspect-[2/3] border border-black/10">
                  <img src={post.data.heroSmImage} alt={post.data.title}
                  class="absolute inset-0 h-full w-full object-cover pointer-events-none select-none"
                  loading="lazy"/>

                <div class="flex flex-col justify-between h-full w-full">
                  <p class="bg-black/25 backdrop-blur-sm border border-white/20 text-right self-end text-white text-base sm:text-sm p-1 px-2 rounded-b-lg rounded-r-none font-bold">
                    <FormattedDate date={post.data.pubDate} format="short"/>
                  </p>

                  <h2 class="bg-black/20 backdrop-blur-sm truncate border-t border-white/20 text-white font-bebas text-start p-2 text-lg rounded-b-lg">
                    {post.data.title}
                  </h2>
                </div>
              </div>
            </a>

          </li>
        ))
      }
    </ul>
  <Footer theme="home" />
  </main>
</Layout>
