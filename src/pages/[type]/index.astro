---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";

const { type } = Astro.params;

export async function getStaticPaths() {
  const posts = await getCollection("texts");
  const types = [...new Set(posts.map((post: any) => post.data.type))]; // Obtener tipos únicos
  return types.map((type) => ({
    params: { type },
  }));
}

let typeTitle: any = "";
if (type === "lagrimas") {
  typeTitle = "Lágrimas de Siddartha";
} else if (type === "colores") {
  typeTitle = "En las luces de colores";
} else if (type === "still") {
  typeTitle = "Still Prefer Sentir";
} else if (type === "placebo") {
  typeTitle = "Placebo Onírico";
} else {
  typeTitle = type;
}

const posts = (await getCollection("texts"))
  .sort((a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .filter((post: any) => post.data.type === type);
---

<Layout title={typeTitle}>
  <main class="flex flex-col gap-4 mt-32 px-4 w-full">
    <h1 class="bg-black/25 backdrop-blur-md border border-white/20 rounded-xl text-2xl font-bold text-left px-2 py-1 pb-0 font-bebas">
      {typeTitle}
    </h1>
    <ul class="flex flex-col w-full gap-6 text-center justify-center px-2">
      {
        posts.map((post: any) => (

          <li class="w-full text-center">
            <a href={`/${type}/${post.slug}/`} class="">
              <div class="relative overflow-hidden rounded-xl aspect-[3/1] border border-white/10">
                  <img src={post.data.heroSmImage} alt={post.data.title}
                  class="absolute inset-0 h-full w-full object-cover pointer-events-none select-none"
                  loading="lazy"/>

                <div class="flex flex-col justify-between h-full w-full p-3">
                  <p class="bg-black/25 backdrop-blur-md border border-white/20 text-right self-end text-white text-sm p-1 px-2 rounded-lg font-bold">
                    <FormattedDate date={post.data.pubDate} format="short"/>
                  </p>

                  <h2 class="bg-black/25 backdrop-blur-md border border-white/20 text-white font-bebas text-start p-1 px-2 pb-0 text-lg rounded-lg">
                    {post.data.title}
                  </h2>
                </div>
              </div>
            </a>

          </li>
        ))
      }
    </ul>
  </main>
</Layout>
